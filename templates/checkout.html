<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout - Cyborg Gaming</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='vendor/bootstrap/css/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='assets/css/templatemo-cyborg-gaming.css') }}">
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
    <div class="container-fluid">

        <a class="navbar-brand" href="{{ url_for('home') }}">Game Store</a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navContent">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navContent">

            <!-- LEFT SIDE -->
            <ul class="navbar-nav me-auto">
                <li class="nav-item">
                    <a class="nav-link" href="{{ url_for('browse') }}">Browse</a>
                </li>
            </ul>

            <!-- RIGHT SIDE -->
            <ul class="navbar-nav">

                {% if session.get('user_id') %}
                <!-- Logged in -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" id="profileMenu" data-bs-toggle="dropdown">
                        <img src="{{ url_for('static', filename='images/profile.png') }}" style="width:30px; height:30px; border-radius:50%; margin-right:6px;">
                        {{ session.get('username') }}
                    </a>
                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="{{ url_for('profile') }}">My Profile</a></li>
                        <li><a class="dropdown-item" href="{{ url_for('logout') }}">Logout</a></li>
                    </ul>
                </li>
                <li class="nav-item ms-2">
                    <a class="btn btn-primary" href="{{ url_for('library') }}">View My Library</a>
                </li>
                {% else %}
                <!-- Guest -->
                <li class="nav-item me-2">
                    <a class="btn btn-outline-light" href="{{ url_for('login') }}">Login</a>
                </li>
                <li class="nav-item">
                    <a class="btn btn-primary" href="{{ url_for('register') }}">Signup</a>
                </li>
                {% endif %}

            </ul>
        </div>
    </div>
</nav>
<!-- END NAVBAR -->

<div class="container my-5">
    <h2>Checkout</h2>

    {% if user %}
        <p>User: <strong>{{ user.username }}</strong> | Balance: <strong>${{ '%.2f'|format(user.balance or 0) }}</strong></p>
    {% endif %}

    {% if cart_items %}
    <form method="POST">
        <table class="table table-striped">
            <thead>
                <tr>
                    <th>Game</th>
                    <th>Price</th>
                    <th>Quantity</th>
                    <th>Subtotal</th>
                </tr>
            </thead>
            <tbody>
                {% for item in cart_items %}
                <tr>
                    <td>{{ item.game.title }}</td>
                    <td>${{ '%.2f'|format(item.game.price or 0) }}</td>
                    <td>{{ item.quantity }}</td>
                    <td>${{ '%.2f'|format(item.subtotal) }}</td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
        <h4>Total: ${{ '%.2f'|format(total_price) }}</h4>
        <button type="submit" class="btn btn-success">Confirm Purchase</button>
    </form>
    {% else %}
        <p>Your cart is empty!</p>
    {% endif %}
</div>

</body>
</html>
