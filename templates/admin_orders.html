{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
    <h2 class="mb-4"><i class="bi bi-cart"></i> Orders</h2>

    <!-- Summary Cards -->
    <div class="row mb-4">
        <div class="col-md-3"><div class="card text-center shadow-sm"><div class="card-body">
            <h5>Total Orders

            </h5><p class="fs-4">{{ total_orders }}</p></div></div></div>
        <div class="col-md-3"><div class="card text-center shadow-sm"><div class="card-body">
            <h5>Total Revenue</h5><p class="fs-4">${{ "%.2f"|format(total_revenue) }}</p></div></div></div>
        <div class="col-md-3"><div class="card text-center shadow-sm"><div class="card-body">
            <h6>Completed</h6><span class="badge bg-success fs-4">{{ completed_count }}</span></div></div></div>
        <div class="col-md-3"><div class="card text-center shadow-sm"><div class="card-body">
            <h6>Cancelled</h6><span class="badge bg-danger fs-4">{{ cancelled_count }}</span></div></div></div>
    </div>

    <!-- Orders List -->
    {% for order in orders %}
    <div class="card mb-3 shadow-sm">
        <div class="card-header d-flex justify-content-between align-items-center">
            <div>
                <strong>Order #{{ order.id }}</strong> &mdash;
                <small>{{ order.order_date.strftime("%Y-%m-%d %H:%M") }}</small>
            </div>
            <div>
                <span class="badge
                    {% if order.order_status == 'Processing' %}bg-warning
                    {% elif order.order_status == 'Shipped' %}bg-primary
                    {% elif order.order_status == 'Completed' %}bg-success
                    {% else %}bg-danger{% endif %}">
                    {{ order.order_status }}
                </span>
            </div>
        </div>
        <div class="card-body">
            <p><strong>User:</strong> {{ order.user.username }} (ID: {{ order.user.id }})</p>
            <p><strong>Total:</strong> ${{ "%.2f"|format(order.total_price) }}</p>

            <a href="{{ url_for('admin.order_detail', order_id=order.id) }}"
               class="btn btn-sm btn-info text-white me-2">
               <i class="bi bi-eye"></i> View Details
            </a>

            {% if order.order_status != 'Cancelled' %}
            <form action="{{ url_for('admin.order_detail', order_id=order.id) }}" method="POST" style="display:inline;">
                <button type="submit" class="btn btn-sm btn-danger"
                        onclick="return confirm('Cancel this order?');">
                    <i class="bi bi-x-circle"></i> Cancel
                </button>
            </form>
            {% endif %}
        </div>
    </div>
    {% else %}
    <p class="text-muted">No orders found.</p>
    {% endfor %}
</div>
{% endblock %}
